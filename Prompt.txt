【追加実装依頼：BO3二重発火修正 + レート表示追加】

■ ① BO3勝利時の勝敗判定が二重発火する問題（最優先）

現象：
・4並び後にラベル表示中にも盤面クリア処理が走っている
・BO3で3pt到達時、「勝利しました。5秒後に戻ります」表示中に再度勝敗判定が走る
・その影響か users/{uid} の rating/matchCount/winCount が更新されないケースがある

修正方針：
1) ラウンド勝利とマッチ勝利を完全分離
2) BO3確定時は盤面クリアや次ラウンド準備を絶対に実行しない
3) 勝敗確定処理は1回だけ実行されるようガードフラグ追加
   例：
   if (isMatchFinalized) return;
   isMatchFinalized = true;
4) レーティングTransaction → 成功確認 → rooms削除 の順序保証
5) BO3確定後は入力・タイマー・再判定を完全停止

期待動作：
・BO3勝利時に勝敗処理は必ず1回のみ
・users更新が必ず実行される
・rooms削除はTransaction完了後のみ


■ ② レートと階級を名前の下に表示（ロビー＆バトル両方）

対象画面：
・キャラ選択画面
・バトル画面（両プレイヤー分）

表示形式：
例）
うーこ
Silver 1523

仕様：
・users/{uid} から rating と rankTier を取得
・未取得時は「---」表示
・Anonymousログイン完了後に取得
・バトル画面では自分と相手両方取得して表示

UI仕様：
・フォント小さめ（12〜14px）
・rankTierごとに色変更
  Bronze: #b87333
  Silver: #c0c0c0
  Gold: #ffd700
  Legend: #a855f7
  BakataLegend: グラデ or 強調色

注意点：
・usersが存在しない場合は初期値（1500 / Silver）
・取得失敗してもゲーム進行は止めない
・レート表示はランキング有無に関係なく常時表示

以上、Phase1として実装お願いします。